import{d as U,r as i,o as F,c as n,a as s,f as y,b,i as g,e as d,p as P,t as r,F as C,n as I,w as z,g as N,A as q,B as O,h as W,C as _,v as X,k as o}from"./index-FuMGBNr_.js";import{P as H,T as J}from"./trash-2-C3yPm7fe.js";import{R as Q}from"./refresh-cw-B5UK-0jM.js";import{T as Y}from"./triangle-alert-1Rn6Vmyi.js";import{G as M}from"./globe-izEBIBLJ.js";import{X as G}from"./x-CSfYnYOr.js";import{S as Z}from"./save-sGnfBaPx.js";import{S as ee}from"./square-pen-DfF-Q1Qq.js";import"./createLucideIcon-DPGb8pea.js";const se={class:"space-y-4"},te={class:"flex flex-col sm:flex-row gap-3 justify-between"},le=["disabled"],ae={key:0,class:"alert alert-error"},oe={key:1,class:"flex justify-center py-12"},ne={key:2,class:"card bg-base-100 shadow-sm"},ie={class:"card-body items-center text-center py-12"},de={class:"w-16 h-16 rounded-full bg-base-200 flex items-center justify-center mb-4"},re={key:3,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},ue={class:"card-body"},ce={class:"flex items-start justify-between"},ve={class:"flex items-center gap-3"},be={class:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center"},me={class:"font-semibold"},pe={class:"text-sm text-base-content/60"},fe={class:"text-xs text-base-content/40 mt-2"},ye={class:"card-actions justify-end mt-2"},ge=["onClick"],_e=["onClick"],he={class:"modal-box"},ke={class:"font-bold text-lg mb-4"},xe={key:0,class:"alert alert-error text-sm"},we={class:"form-control"},Ce={class:"form-control"},De=["disabled"],Se=["value"],Ae={class:"divider text-sm"},Pe={key:0,class:"text-sm text-base-content/60 bg-base-200 p-3 rounded-lg mb-3"},Ie={class:"label"},Ne={class:"label-text"},Te=["onUpdate:modelValue","type","placeholder"],Me={class:"modal-action"},Ge=["disabled"],Ke={key:0,class:"loading loading-spinner loading-sm"},Ve={class:"modal-box"},$e={class:"modal-action"},je=["disabled"],Ee={key:0,class:"loading loading-spinner loading-sm"},Be={method:"dialog",class:"modal-backdrop"},Je=U({__name:"DnsProviders",setup(Le){const D=i([]),f=i(!0),m=i(""),S=[{value:"cloudflare",label:"Cloudflare",fields:["api_key","email"],hint:"Global API Key + Email 方式"},{value:"aliyun",label:"阿里云 DNS",fields:["access_key_id","access_key_secret"]},{value:"dnspod",label:"DNSPod",fields:["api_id","api_token"]},{value:"route53",label:"AWS Route53",fields:["access_key_id","secret_access_key","region"]},{value:"godaddy",label:"GoDaddy",fields:["api_key","api_secret"]}],K={api_key:"Global API Key",email:"Cloudflare 邮箱",api_token:"API Token",access_key_id:"Access Key ID",access_key_secret:"Access Key Secret",secret_access_key:"Secret Access Key",region:"Region",api_id:"API ID",api_secret:"API Secret"},p=i(!1),u=i(!1),h=i(null),l=i({name:"",type:"",config:{}}),k=i(!1),c=i(""),v=i(null),x=i(!1);async function w(){f.value=!0,m.value="";try{const{data:a}=await _.list();D.value=a||[]}catch(a){const e=a;m.value=e.message||"加载失败"}finally{f.value=!1}}function V(a){return a?new Date(a).toLocaleDateString("zh-CN"):"-"}function $(a){return S.find(t=>t.value===a)?.label||a}function T(a){return S.find(t=>t.value===a)?.fields||[]}function j(){u.value=!1,h.value=null,l.value={name:"",type:"",config:{}},c.value="",p.value=!0}async function E(a){u.value=!0,h.value=a.id,c.value="";try{const{data:e}=await _.get(a.id);l.value={name:e.name,type:e.type,config:{}},p.value=!0}catch(e){const t=e;m.value=t.response?.data?.error?.message||"加载配置失败"}}function B(){l.value.config={}}async function L(){if(c.value="",!l.value.name){c.value="请输入名称";return}if(!l.value.type){c.value="请选择类型";return}const a=T(l.value.type);for(const e of a)if(!u.value&&!l.value.config[e]){c.value=`请填写 ${e}`;return}k.value=!0;try{if(u.value&&h.value){const e={name:l.value.name,type:l.value.type};Object.keys(l.value.config).length>0&&(e.config=l.value.config),await _.update(h.value,e)}else await _.create(l.value);p.value=!1,await w()}catch(e){const t=e;c.value=t.response?.data?.error?.message||"保存失败"}finally{k.value=!1}}async function R(){if(v.value){x.value=!0;try{await _.delete(v.value),v.value=null,await w()}catch(a){const e=a;m.value=e.response?.data?.error?.message||"删除失败",v.value=null}finally{x.value=!1}}}return F(w),(a,e)=>(o(),n("div",se,[s("div",te,[s("button",{class:"btn btn-primary",onClick:j},[b(d(H),{class:"w-4 h-4"}),e[7]||(e[7]=g(" 添加提供商 ",-1))]),s("button",{class:"btn btn-ghost btn-sm",onClick:w,disabled:f.value},[b(d(Q),{class:P(["w-4 h-4",f.value&&"animate-spin"])},null,8,["class"]),e[8]||(e[8]=g(" 刷新 ",-1))],8,le)]),m.value?(o(),n("div",ae,[b(d(Y),{class:"w-5 h-5"}),s("span",null,r(m.value),1)])):y("",!0),f.value?(o(),n("div",oe,[...e[9]||(e[9]=[s("span",{class:"loading loading-spinner loading-lg"},null,-1)])])):D.value.length===0?(o(),n("div",ne,[s("div",ie,[s("div",de,[b(d(M),{class:"w-8 h-8 text-base-content/40"})]),e[10]||(e[10]=s("h3",{class:"text-lg font-semibold"},"暂无 DNS 提供商",-1)),e[11]||(e[11]=s("p",{class:"text-base-content/60"},"添加 DNS 提供商后才能申请证书",-1))])])):(o(),n("div",re,[(o(!0),n(C,null,I(D.value,t=>(o(),n("div",{key:t.id,class:"card bg-base-100 shadow-sm hover:shadow-md transition-shadow"},[s("div",ue,[s("div",ce,[s("div",ve,[s("div",be,[b(d(M),{class:"w-5 h-5 text-primary"})]),s("div",null,[s("h3",me,r(t.name),1),s("p",pe,r($(t.type)),1)])])]),s("div",fe," 创建于 "+r(V(t.created_at)),1),s("div",ye,[s("button",{class:"btn btn-ghost btn-sm",onClick:A=>E(t)},[b(d(ee),{class:"w-4 h-4"}),e[12]||(e[12]=g(" 编辑 ",-1))],8,ge),s("button",{class:"btn btn-ghost btn-sm text-error",onClick:A=>v.value=t.id},[b(d(J),{class:"w-4 h-4"})],8,_e)])])]))),128))])),s("dialog",{class:P(["modal",p.value&&"modal-open"])},[s("div",he,[s("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=t=>p.value=!1)},[b(d(G),{class:"w-4 h-4"})]),s("h3",ke,r(u.value?"编辑":"添加")+" DNS 提供商",1),s("form",{onSubmit:z(L,["prevent"]),class:"space-y-4"},[c.value?(o(),n("div",xe,r(c.value),1)):y("",!0),s("div",we,[e[13]||(e[13]=s("label",{class:"label"},[s("span",{class:"label-text"},"名称 *")],-1)),N(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.name=t),type:"text",class:"input input-bordered",placeholder:"例如: 我的 Cloudflare"},null,512),[[q,l.value.name]])]),s("div",Ce,[e[15]||(e[15]=s("label",{class:"label"},[s("span",{class:"label-text"},"类型 *")],-1)),N(s("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.type=t),class:"select select-bordered",onChange:B,disabled:u.value},[e[14]||(e[14]=s("option",{value:"",disabled:""},"请选择",-1)),(o(),n(C,null,I(S,t=>s("option",{key:t.value,value:t.value},r(t.label),9,Se)),64))],40,De),[[O,l.value.type]])]),l.value.type?(o(),n(C,{key:1},[s("div",Ae,"API 配置"+r(u.value?" (留空则不修改)":""),1),l.value.type==="cloudflare"?(o(),n("div",Pe,[...e[16]||(e[16]=[s("p",null,"使用 Cloudflare Global API Key + Email 方式认证",-1),s("p",{class:"mt-1"},"Global API Key 可在 Cloudflare 控制台 → My Profile → API Tokens → Global API Key 获取",-1)])])):y("",!0),(o(!0),n(C,null,I(T(l.value.type),t=>(o(),n("div",{key:t,class:"form-control"},[s("label",Ie,[s("span",Ne,r(K[t]||t)+r(u.value?"":" *"),1)]),N(s("input",{"onUpdate:modelValue":A=>l.value.config[t]=A,type:t.includes("secret")||t.includes("token")||t==="api_key"?"password":"text",class:"input input-bordered",placeholder:u.value?"留空则不修改":""},null,8,Te),[[X,l.value.config[t]]])]))),128))],64)):y("",!0),s("div",Me,[s("button",{type:"button",class:"btn",onClick:e[3]||(e[3]=t=>p.value=!1)},"取消"),s("button",{type:"submit",class:"btn btn-primary",disabled:k.value},[k.value?(o(),n("span",Ke)):(o(),W(d(Z),{key:1,class:"w-4 h-4"})),e[17]||(e[17]=g(" 保存 ",-1))],8,Ge)])],32)])],2),s("dialog",{class:P(["modal",v.value!==null&&"modal-open"])},[s("div",Ve,[s("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[4]||(e[4]=t=>v.value=null)},[b(d(G),{class:"w-4 h-4"})]),e[19]||(e[19]=s("h3",{class:"font-bold text-lg"},"确认删除",-1)),e[20]||(e[20]=s("p",{class:"py-4"},"确定要删除这个 DNS 提供商吗？关联的证书将无法续期。",-1)),s("div",$e,[s("button",{class:"btn",onClick:e[5]||(e[5]=t=>v.value=null)},"取消"),s("button",{class:"btn btn-error",disabled:x.value,onClick:R},[x.value?(o(),n("span",Ee)):y("",!0),e[18]||(e[18]=g(" 删除 ",-1))],8,je)])]),s("form",Be,[s("button",{onClick:e[6]||(e[6]=t=>v.value=null)},"close")])],2)]))}});export{Je as default};
