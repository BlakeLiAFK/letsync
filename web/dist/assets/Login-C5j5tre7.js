import{d as k,u as S,r as n,o as V,c as r,a as e,b as L,e as p,t as v,w as j,f as y,g as x,v as _,h as b,i as E,j as B,k as s}from"./index-FuMGBNr_.js";import{S as M}from"./shield-HjQqpK5P.js";import{E as N}from"./eye-tqEmvbwV.js";import{E as C}from"./eye-off-BqtQTmr4.js";import{c as D}from"./createLucideIcon-DPGb8pea.js";const P=D("lock-keyhole",[["circle",{cx:"12",cy:"16",r:"1",key:"1au0dj"}],["rect",{x:"3",y:"10",width:"18",height:"12",rx:"2",key:"6s8ecr"}],["path",{d:"M7 10V7a5 5 0 0 1 10 0v3",key:"1pqi11"}]]),R={class:"min-h-screen bg-gradient-to-br from-base-200 via-base-100 to-base-200 flex items-center justify-center p-4"},U={key:0,class:"flex flex-col items-center gap-4"},q={key:1,class:"w-full max-w-md"},A={class:"text-center mb-8"},F={class:"inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-primary/10 mb-4"},I={class:"card bg-base-100 shadow-xl"},K={class:"card-body"},O={class:"card-title justify-center text-xl mb-4"},T={key:0,class:"alert alert-error"},$={key:1,class:"alert alert-info"},z={class:"form-control"},G={class:"label"},H={class:"label-text"},J={class:"relative"},Q=["type","placeholder"],W={key:2,class:"form-control"},X=["type"],Y=["disabled"],Z={key:0,class:"loading loading-spinner loading-sm"},ne=k({__name:"Login",setup(ee){const w=B(),m=S(),l=n(""),f=n(""),i=n(!1),u=n(!1),o=n(""),a=n(!1),h=n(!0);V(async()=>{const c=await m.checkStatus();a.value=c?.first_run??!1,h.value=!1});async function g(){if(o.value="",!l.value){o.value="请输入密码";return}if(a.value){if(l.value.length<8){o.value="密码长度至少 8 位";return}if(l.value!==f.value){o.value="两次密码不一致";return}}u.value=!0;try{a.value?await m.setup(l.value):await m.login(l.value),w.push("/dashboard")}catch(c){const t=c;o.value=t.response?.data?.error?.message||"操作失败"}finally{u.value=!1}}return(c,t)=>(s(),r("div",R,[h.value?(s(),r("div",U,[...t[3]||(t[3]=[e("span",{class:"loading loading-spinner loading-lg text-primary"},null,-1),e("span",{class:"text-base-content/60"},"正在检查系统状态...",-1)])])):(s(),r("div",q,[e("div",A,[e("div",F,[L(p(M),{class:"w-10 h-10 text-primary"})]),t[4]||(t[4]=e("h1",{class:"text-3xl font-bold text-base-content"},"Letsync",-1)),t[5]||(t[5]=e("p",{class:"text-base-content/60 mt-2"},"SSL 证书自动化管理平台",-1))]),e("div",I,[e("div",K,[e("h2",O,v(a.value?"初始化系统":"管理员登录"),1),e("form",{onSubmit:j(g,["prevent"]),class:"space-y-4"},[o.value?(s(),r("div",T,[e("span",null,v(o.value),1)])):y("",!0),a.value?(s(),r("div",$,[...t[6]||(t[6]=[e("span",null,"首次运行，请设置管理员密码",-1)])])):y("",!0),e("div",z,[e("label",G,[e("span",H,v(a.value?"设置密码":"密码"),1)]),e("div",J,[x(e("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>l.value=d),type:i.value?"text":"password",class:"input input-bordered w-full pr-12",placeholder:a.value?"请输入至少 8 位密码":"请输入密码",autocomplete:"current-password"},null,8,Q),[[_,l.value]]),e("button",{type:"button",class:"absolute right-3 top-1/2 -translate-y-1/2 text-base-content/40 hover:text-base-content",onClick:t[1]||(t[1]=d=>i.value=!i.value)},[i.value?(s(),b(p(C),{key:1,class:"w-5 h-5"})):(s(),b(p(N),{key:0,class:"w-5 h-5"}))])])]),a.value?(s(),r("div",W,[t[7]||(t[7]=e("label",{class:"label"},[e("span",{class:"label-text"},"确认密码")],-1)),x(e("input",{"onUpdate:modelValue":t[2]||(t[2]=d=>f.value=d),type:i.value?"text":"password",class:"input input-bordered w-full",placeholder:"请再次输入密码",autocomplete:"new-password"},null,8,X),[[_,f.value]])])):y("",!0),e("button",{type:"submit",class:"btn btn-primary w-full",disabled:u.value},[u.value?(s(),r("span",Z)):(s(),b(p(P),{key:1,class:"w-5 h-5"})),E(" "+v(a.value?"初始化":"登录"),1)],8,Y)],32)])]),t[8]||(t[8]=e("p",{class:"text-center text-base-content/40 text-sm mt-6"}," Letsync - 让证书管理更简单 ",-1))]))]))}});export{ne as default};
