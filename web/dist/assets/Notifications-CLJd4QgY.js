import{d as q,r as u,o as O,c as o,a as s,f as M,b as p,i as g,e as d,p as D,t as i,F as S,n as N,w as G,g as V,A as H,B as J,D as K,h as $,E as y,v as Q,k as n}from"./index-FuMGBNr_.js";import{P as Y,T as Z}from"./trash-2-C3yPm7fe.js";import{R as ee}from"./refresh-cw-B5UK-0jM.js";import{T as se}from"./triangle-alert-1Rn6Vmyi.js";import{B as U}from"./bell-CGItc6WP.js";import{X as I}from"./x-CSfYnYOr.js";import{S as le}from"./save-sGnfBaPx.js";import{C as te}from"./check-Ib64XTCh.js";import{C as ae}from"./circle-x--W9BfU9X.js";import{c as ne}from"./createLucideIcon-DPGb8pea.js";import{S as oe}from"./square-pen-DfF-Q1Qq.js";const ue=ne("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),de={class:"space-y-4"},ie={class:"flex flex-col sm:flex-row gap-3 justify-between"},re=["disabled"],ce={key:0,class:"alert alert-error"},ve={key:1,class:"flex justify-center py-12"},be={key:2,class:"card bg-base-100 shadow-sm"},pe={class:"card-body items-center text-center py-12"},me={class:"w-16 h-16 rounded-full bg-base-200 flex items-center justify-center mb-4"},fe={key:3,class:"space-y-3"},ge={class:"card-body p-4"},ye={class:"flex flex-col lg:flex-row lg:items-center gap-4"},he={class:"flex-1 min-w-0"},_e={class:"flex items-center gap-2 mb-1"},ke={class:"font-semibold truncate"},xe={class:"flex flex-wrap gap-x-4 text-sm text-base-content/60"},we={class:"flex gap-2"},Ce=["disabled","onClick"],Te={key:0,class:"loading loading-spinner loading-xs"},Me=["onClick"],De=["onClick"],Se={class:"modal-box max-w-lg"},Ve={class:"font-bold text-lg mb-4"},$e={key:0,class:"alert alert-error text-sm"},Be={class:"form-control"},je={class:"form-control"},Ne=["disabled"],Ee=["value"],Ue={class:"form-control"},Ie={class:"cursor-pointer label justify-start gap-3"},Le={class:"divider text-sm"},ze={class:"label"},Ae={class:"label-text"},Fe=["onUpdate:modelValue","type","placeholder"],Pe={class:"modal-action"},Re=["disabled"],We={key:0,class:"loading loading-spinner loading-sm"},Xe={class:"modal-box"},qe={class:"modal-action"},Oe=["disabled"],Ge={key:0,class:"loading loading-spinner loading-sm"},He={method:"dialog",class:"modal-backdrop"},us=q({__name:"Notifications",setup(Je){const B=u([]),h=u(!0),m=u(""),j=[{value:"webhook",label:"Webhook",fields:["url"]},{value:"email",label:"邮件",fields:["smtp_host","smtp_port","smtp_user","smtp_pass","from","to"]},{value:"telegram",label:"Telegram",fields:["bot_token","chat_id"]},{value:"bark",label:"Bark",fields:["server_url","device_key"]}],f=u(!1),r=u(!1),_=u(null),a=u({name:"",type:"",config:{},enabled:!0}),k=u(!1),c=u(""),v=u(null),x=u(!1),w=u(null),b=u(null);async function C(){h.value=!0,m.value="";try{const{data:t}=await y.list();B.value=t||[]}catch(t){const e=t;m.value=e.message||"加载失败"}finally{h.value=!1}}function L(t){return t?new Date(t).toLocaleDateString("zh-CN"):"-"}function z(t){return j.find(l=>l.value===t)?.label||t}function E(t){return j.find(l=>l.value===t)?.fields||[]}function A(){r.value=!1,_.value=null,a.value={name:"",type:"",config:{},enabled:!0},c.value="",f.value=!0}async function F(t){r.value=!0,_.value=t.id,c.value="";try{const{data:e}=await y.get(t.id);a.value={name:e.name,type:e.type,config:{},enabled:e.enabled},f.value=!0}catch(e){const l=e;m.value=l.response?.data?.error?.message||"加载配置失败"}}function P(){a.value.config={}}async function R(){if(c.value="",!a.value.name){c.value="请输入名称";return}if(!a.value.type){c.value="请选择类型";return}const t=E(a.value.type);for(const e of t)if(!r.value&&!a.value.config[e]){c.value=`请填写 ${e}`;return}k.value=!0;try{if(r.value&&_.value){const e={name:a.value.name,type:a.value.type,enabled:a.value.enabled};Object.keys(a.value.config).length>0&&(e.config=a.value.config),await y.update(_.value,e)}else await y.create(a.value);f.value=!1,await C()}catch(e){const l=e;c.value=l.response?.data?.error?.message||"保存失败"}finally{k.value=!1}}async function W(){if(v.value){x.value=!0;try{await y.delete(v.value),v.value=null,await C()}catch(t){const e=t;m.value=e.response?.data?.error?.message||"删除失败",v.value=null}finally{x.value=!1}}}async function X(t){w.value=t,b.value=null;try{await y.test(t),b.value={id:t,success:!0}}catch{b.value={id:t,success:!1}}finally{w.value=null,setTimeout(()=>{b.value?.id===t&&(b.value=null)},3e3)}}return O(C),(t,e)=>(n(),o("div",de,[s("div",ie,[s("button",{class:"btn btn-primary",onClick:A},[p(d(Y),{class:"w-4 h-4"}),e[8]||(e[8]=g(" 添加通知渠道 ",-1))]),s("button",{class:"btn btn-ghost btn-sm",onClick:C,disabled:h.value},[p(d(ee),{class:D(["w-4 h-4",h.value&&"animate-spin"])},null,8,["class"]),e[9]||(e[9]=g(" 刷新 ",-1))],8,re)]),m.value?(n(),o("div",ce,[p(d(se),{class:"w-5 h-5"}),s("span",null,i(m.value),1)])):M("",!0),h.value?(n(),o("div",ve,[...e[10]||(e[10]=[s("span",{class:"loading loading-spinner loading-lg"},null,-1)])])):B.value.length===0?(n(),o("div",be,[s("div",pe,[s("div",me,[p(d(U),{class:"w-8 h-8 text-base-content/40"})]),e[11]||(e[11]=s("h3",{class:"text-lg font-semibold"},"暂无通知渠道",-1)),e[12]||(e[12]=s("p",{class:"text-base-content/60"},"添加通知渠道以接收证书到期提醒",-1))])])):(n(),o("div",fe,[(n(!0),o(S,null,N(B.value,l=>(n(),o("div",{key:l.id,class:"card bg-base-100 shadow-sm hover:shadow-md transition-shadow"},[s("div",ge,[s("div",ye,[s("div",he,[s("div",_e,[p(d(U),{class:"w-5 h-5 text-base-content/40"}),s("h3",ke,i(l.name),1),s("div",{class:D(["badge badge-sm",l.enabled?"badge-success":"badge-ghost"])},i(l.enabled?"启用":"禁用"),3)]),s("div",xe,[s("span",null,"类型: "+i(z(l.type)),1),s("span",null,"创建于 "+i(L(l.created_at)),1)])]),s("div",we,[s("button",{class:"btn btn-ghost btn-sm",disabled:w.value===l.id,onClick:T=>X(l.id)},[w.value===l.id?(n(),o("span",Te)):b.value?.id===l.id&&b.value.success?(n(),$(d(te),{key:1,class:"w-4 h-4 text-success"})):b.value?.id===l.id&&!b.value.success?(n(),$(d(ae),{key:2,class:"w-4 h-4 text-error"})):(n(),$(d(ue),{key:3,class:"w-4 h-4"})),e[13]||(e[13]=g(" 测试 ",-1))],8,Ce),s("button",{class:"btn btn-ghost btn-sm",onClick:T=>F(l)},[p(d(oe),{class:"w-4 h-4"}),e[14]||(e[14]=g(" 编辑 ",-1))],8,Me),s("button",{class:"btn btn-ghost btn-sm text-error",onClick:T=>v.value=l.id},[p(d(Z),{class:"w-4 h-4"})],8,De)])])])]))),128))])),s("dialog",{class:D(["modal",f.value&&"modal-open"])},[s("div",Se,[s("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=l=>f.value=!1)},[p(d(I),{class:"w-4 h-4"})]),s("h3",Ve,i(r.value?"编辑":"添加")+"通知渠道",1),s("form",{onSubmit:G(R,["prevent"]),class:"space-y-4"},[c.value?(n(),o("div",$e,i(c.value),1)):M("",!0),s("div",Be,[e[15]||(e[15]=s("label",{class:"label"},[s("span",{class:"label-text"},"名称 *")],-1)),V(s("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.name=l),type:"text",class:"input input-bordered",placeholder:"例如: 我的 Webhook"},null,512),[[H,a.value.name]])]),s("div",je,[e[17]||(e[17]=s("label",{class:"label"},[s("span",{class:"label-text"},"类型 *")],-1)),V(s("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.type=l),class:"select select-bordered",onChange:P,disabled:r.value},[e[16]||(e[16]=s("option",{value:"",disabled:""},"请选择",-1)),(n(),o(S,null,N(j,l=>s("option",{key:l.value,value:l.value},i(l.label),9,Ee)),64))],40,Ne),[[J,a.value.type]])]),s("div",Ue,[s("label",Ie,[V(s("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.enabled=l),type:"checkbox",class:"toggle toggle-primary"},null,512),[[K,a.value.enabled]]),e[18]||(e[18]=s("span",{class:"label-text"},"启用通知",-1))])]),a.value.type?(n(),o(S,{key:1},[s("div",Le,"配置"+i(r.value?" (留空则不修改)":""),1),(n(!0),o(S,null,N(E(a.value.type),l=>(n(),o("div",{key:l,class:"form-control"},[s("label",ze,[s("span",Ae,i(l)+i(r.value?"":" *"),1)]),V(s("input",{"onUpdate:modelValue":T=>a.value.config[l]=T,type:l.includes("pass")||l.includes("token")||l.includes("secret")?"password":"text",class:"input input-bordered",placeholder:r.value?"留空则不修改":""},null,8,Fe),[[Q,a.value.config[l]]])]))),128))],64)):M("",!0),s("div",Pe,[s("button",{type:"button",class:"btn",onClick:e[4]||(e[4]=l=>f.value=!1)},"取消"),s("button",{type:"submit",class:"btn btn-primary",disabled:k.value},[k.value?(n(),o("span",We)):(n(),$(d(le),{key:1,class:"w-4 h-4"})),e[19]||(e[19]=g(" 保存 ",-1))],8,Re)])],32)])],2),s("dialog",{class:D(["modal",v.value!==null&&"modal-open"])},[s("div",Xe,[s("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[5]||(e[5]=l=>v.value=null)},[p(d(I),{class:"w-4 h-4"})]),e[21]||(e[21]=s("h3",{class:"font-bold text-lg"},"确认删除",-1)),e[22]||(e[22]=s("p",{class:"py-4"},"确定要删除这个通知渠道吗？",-1)),s("div",qe,[s("button",{class:"btn",onClick:e[6]||(e[6]=l=>v.value=null)},"取消"),s("button",{class:"btn btn-error",disabled:x.value,onClick:W},[x.value?(n(),o("span",Ge)):M("",!0),e[20]||(e[20]=g(" 删除 ",-1))],8,Oe)])]),s("form",He,[s("button",{onClick:e[7]||(e[7]=l=>v.value=null)},"close")])],2)]))}});export{us as default};
