import{d as F,u as q,r as i,o as I,c as d,f as P,a as e,b as c,e as n,t as f,F as S,i as u,g as m,A as E,B as L,n as M,h as _,w as O,v as C,p as G,I as A,k as a}from"./index-FuMGBNr_.js";import{T as X}from"./triangle-alert-1Rn6Vmyi.js";import{S as T}from"./shield-HjQqpK5P.js";import{S as Z}from"./settings-yVWdsVBl.js";import{c as $}from"./createLucideIcon-DPGb8pea.js";import{C as H}from"./clock-CWxjY3HO.js";import{R as J}from"./refresh-cw-B5UK-0jM.js";import{S as K}from"./save-sGnfBaPx.js";import{X as Q}from"./x-CSfYnYOr.js";import{E as U}from"./eye-tqEmvbwV.js";import{E as B}from"./eye-off-BqtQTmr4.js";const W=$("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);const Y=$("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),ee={class:"space-y-6"},se={key:0,class:"alert alert-error"},te={key:1,class:"alert alert-success"},ae={key:2,class:"flex justify-center py-12"},le={class:"card bg-base-100 shadow-sm"},oe={class:"card-body"},ne={class:"card-title text-lg mb-4"},re={class:"space-y-4"},ie={class:"form-control"},de={class:"label"},ue={class:"label-text flex items-center gap-2"},ce={class:"form-control"},ve=["value"],pe={class:"form-control"},me=["value"],be={class:"form-control"},ye={class:"label"},we={class:"label-text flex items-center gap-2"},fe={class:"card-actions justify-end mt-4"},_e=["disabled"],ge=["disabled"],he={key:0,class:"loading loading-spinner loading-sm"},xe={class:"card bg-base-100 shadow-sm"},ke={class:"card-body"},Pe={class:"card-title text-lg mb-4"},Se={class:"flex items-center justify-between"},Ce={class:"card bg-base-100 shadow-sm"},Ve={class:"card-body"},Ee={class:"card-title text-lg mb-4"},Le={class:"modal-box"},Me={key:0,class:"alert alert-error text-sm"},Ae={class:"form-control"},Te={class:"relative"},Ue=["type"],Be={class:"form-control"},$e={class:"relative"},De=["type"],Ne={class:"form-control"},ze=["type"],Re={class:"modal-action"},je=["disabled"],Fe={key:0,class:"loading loading-spinner loading-sm"},qe={method:"dialog",class:"modal-backdrop"},ss=F({__name:"Settings",setup(Ie){const D=q(),g=i(!0),h=i(!1),b=i(""),p=i(""),r=i({acme_email:"",acme_directory:"https://acme-v02.api.letsencrypt.org/directory",acme_key_type:"ec256",renew_days_before:"30"}),y=i(!1),l=i({oldPassword:"",newPassword:"",confirmPassword:""}),x=i(!1),v=i(""),k=i(!1),w=i(!1),N=[{value:"https://acme-v02.api.letsencrypt.org/directory",label:"Let's Encrypt 生产环境"},{value:"https://acme-staging-v02.api.letsencrypt.org/directory",label:"Let's Encrypt 测试环境"},{value:"https://api.buypass.com/acme/directory",label:"Buypass Go SSL"},{value:"https://acme.zerossl.com/v2/DV90",label:"ZeroSSL"}],z=[{value:"ec256",label:"EC P-256 (推荐)"},{value:"ec384",label:"EC P-384"},{value:"rsa2048",label:"RSA 2048"},{value:"rsa4096",label:"RSA 4096"}];async function V(){g.value=!0,b.value="";try{const{data:o}=await A.getAll();o&&(r.value={acme_email:o.acme?.email||"",acme_directory:o.acme?.ca_url||"https://acme-v02.api.letsencrypt.org/directory",acme_key_type:o.acme?.key_type||"ec256",renew_days_before:o.scheduler?.renew_before_days||"30"})}catch(o){const s=o;b.value=s.response?.data?.error?.message||"加载失败"}finally{g.value=!1}}async function R(){h.value=!0,b.value="",p.value="";try{const o={"acme.email":r.value.acme_email,"acme.ca_url":r.value.acme_directory,"acme.key_type":r.value.acme_key_type,"scheduler.renew_before_days":r.value.renew_days_before};await A.update(o),p.value="保存成功",setTimeout(()=>{p.value=""},3e3)}catch(o){const s=o;b.value=s.response?.data?.error?.message||"保存失败"}finally{h.value=!1}}async function j(){if(v.value="",!l.value.oldPassword){v.value="请输入当前密码";return}if(!l.value.newPassword){v.value="请输入新密码";return}if(l.value.newPassword.length<8){v.value="新密码长度至少 8 位";return}if(l.value.newPassword!==l.value.confirmPassword){v.value="两次密码不一致";return}x.value=!0;try{await D.changePassword(l.value.oldPassword,l.value.newPassword),y.value=!1,l.value={oldPassword:"",newPassword:"",confirmPassword:""},p.value="密码修改成功",setTimeout(()=>{p.value=""},3e3)}catch(o){const s=o;v.value=s.response?.data?.error?.message||"修改失败"}finally{x.value=!1}}return I(V),(o,s)=>(a(),d("div",ee,[b.value?(a(),d("div",se,[c(n(X),{class:"w-5 h-5"}),e("span",null,f(b.value),1)])):P("",!0),p.value?(a(),d("div",te,[c(n(T),{class:"w-5 h-5"}),e("span",null,f(p.value),1)])):P("",!0),g.value?(a(),d("div",ae,[...s[13]||(s[13]=[e("span",{class:"loading loading-spinner loading-lg"},null,-1)])])):(a(),d(S,{key:3},[e("div",le,[e("div",oe,[e("h2",ne,[c(n(Z),{class:"w-5 h-5"}),s[14]||(s[14]=u(" ACME 设置 ",-1))]),e("div",re,[e("div",ie,[e("label",de,[e("span",ue,[c(n(Y),{class:"w-4 h-4"}),s[15]||(s[15]=u(" 联系邮箱 ",-1))])]),m(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>r.value.acme_email=t),type:"email",class:"input input-bordered",placeholder:"admin@example.com"},null,512),[[E,r.value.acme_email]]),s[16]||(s[16]=e("label",{class:"label"},[e("span",{class:"label-text-alt"},"用于接收证书到期通知和账户恢复")],-1))]),e("div",ce,[s[17]||(s[17]=e("label",{class:"label"},[e("span",{class:"label-text"},"ACME 目录")],-1)),m(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>r.value.acme_directory=t),class:"select select-bordered"},[(a(),d(S,null,M(N,t=>e("option",{key:t.value,value:t.value},f(t.label),9,ve)),64))],512),[[L,r.value.acme_directory]])]),e("div",pe,[s[18]||(s[18]=e("label",{class:"label"},[e("span",{class:"label-text"},"密钥类型")],-1)),m(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>r.value.acme_key_type=t),class:"select select-bordered"},[(a(),d(S,null,M(z,t=>e("option",{key:t.value,value:t.value},f(t.label),9,me)),64))],512),[[L,r.value.acme_key_type]])]),e("div",be,[e("label",ye,[e("span",we,[c(n(H),{class:"w-4 h-4"}),s[19]||(s[19]=u(" 提前续期天数 ",-1))])]),m(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>r.value.renew_days_before=t),type:"number",class:"input input-bordered w-32",min:"1",max:"60"},null,512),[[E,r.value.renew_days_before]]),s[20]||(s[20]=e("label",{class:"label"},[e("span",{class:"label-text-alt"},"证书到期前多少天自动续期")],-1))])]),e("div",fe,[e("button",{class:"btn btn-ghost",onClick:V,disabled:g.value},[c(n(J),{class:"w-4 h-4"}),s[21]||(s[21]=u(" 重置 ",-1))],8,_e),e("button",{class:"btn btn-primary",onClick:R,disabled:h.value},[h.value?(a(),d("span",he)):(a(),_(n(K),{key:1,class:"w-4 h-4"})),s[22]||(s[22]=u(" 保存 ",-1))],8,ge)])])]),e("div",xe,[e("div",ke,[e("h2",Pe,[c(n(W),{class:"w-5 h-5"}),s[23]||(s[23]=u(" 安全设置 ",-1))]),e("div",Se,[s[24]||(s[24]=e("div",null,[e("p",{class:"font-medium"},"管理员密码"),e("p",{class:"text-sm text-base-content/60"},"修改登录密码")],-1)),e("button",{class:"btn btn-outline",onClick:s[4]||(s[4]=t=>y.value=!0)}," 修改密码 ")])])]),e("div",Ce,[e("div",Ve,[e("h2",Ee,[c(n(T),{class:"w-5 h-5"}),s[25]||(s[25]=u(" 关于 ",-1))]),s[26]||(s[26]=e("div",{class:"space-y-2 text-sm"},[e("p",null,[e("span",{class:"text-base-content/60"},"版本:"),u(" 1.0.0")]),e("p",null,[e("span",{class:"text-base-content/60"},"项目:"),u(" Letsync - SSL 证书自动化管理平台")])],-1))])])],64)),e("dialog",{class:G(["modal",y.value&&"modal-open"])},[e("div",Le,[e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:s[5]||(s[5]=t=>y.value=!1)},[c(n(Q),{class:"w-4 h-4"})]),s[31]||(s[31]=e("h3",{class:"font-bold text-lg mb-4"},"修改密码",-1)),e("form",{onSubmit:O(j,["prevent"]),class:"space-y-4"},[v.value?(a(),d("div",Me,f(v.value),1)):P("",!0),e("div",Ae,[s[27]||(s[27]=e("label",{class:"label"},[e("span",{class:"label-text"},"当前密码")],-1)),e("div",Te,[m(e("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>l.value.oldPassword=t),type:k.value?"text":"password",class:"input input-bordered w-full pr-12"},null,8,Ue),[[C,l.value.oldPassword]]),e("button",{type:"button",class:"absolute right-3 top-1/2 -translate-y-1/2",onClick:s[7]||(s[7]=t=>k.value=!k.value)},[k.value?(a(),_(n(B),{key:1,class:"w-5 h-5 text-base-content/40"})):(a(),_(n(U),{key:0,class:"w-5 h-5 text-base-content/40"}))])])]),e("div",Be,[s[28]||(s[28]=e("label",{class:"label"},[e("span",{class:"label-text"},"新密码")],-1)),e("div",$e,[m(e("input",{"onUpdate:modelValue":s[8]||(s[8]=t=>l.value.newPassword=t),type:w.value?"text":"password",class:"input input-bordered w-full pr-12",placeholder:"至少 8 位"},null,8,De),[[C,l.value.newPassword]]),e("button",{type:"button",class:"absolute right-3 top-1/2 -translate-y-1/2",onClick:s[9]||(s[9]=t=>w.value=!w.value)},[w.value?(a(),_(n(B),{key:1,class:"w-5 h-5 text-base-content/40"})):(a(),_(n(U),{key:0,class:"w-5 h-5 text-base-content/40"}))])])]),e("div",Ne,[s[29]||(s[29]=e("label",{class:"label"},[e("span",{class:"label-text"},"确认新密码")],-1)),m(e("input",{"onUpdate:modelValue":s[10]||(s[10]=t=>l.value.confirmPassword=t),type:w.value?"text":"password",class:"input input-bordered"},null,8,ze),[[C,l.value.confirmPassword]])]),e("div",Re,[e("button",{type:"button",class:"btn",onClick:s[11]||(s[11]=t=>y.value=!1)},"取消"),e("button",{type:"submit",class:"btn btn-primary",disabled:x.value},[x.value?(a(),d("span",Fe)):P("",!0),s[30]||(s[30]=u(" 确认修改 ",-1))],8,je)])],32)]),e("form",qe,[e("button",{onClick:s[12]||(s[12]=t=>y.value=!1)},"close")])],2)]))}});export{ss as default};
